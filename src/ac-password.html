<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<!-- <link rel="import" href="../bower_components/ac-style/ac-style.html">
<link rel="import" href="../bower_components/ac-input/ac-input.html">
<link rel="import" href="../bower_components/ac-button/ac-button.html"> -->
<link rel="import" href="../bower_components/sc-style/sc-style.html">
<link rel="import" href="../bower_components/sc-iconset/sc-iconset.html">

<dom-module id="ac-password">
<link rel="import" href="../bower_components/sc-style/sc-style.css"  type="css">

  <!-- Defines the element's style and local DOM -->
  <template>
    <style>
      :host {
        display: block;
      }

      paper-input {
        width: 100%;
        max-width: 400px;
      }

    p {
      font-size: 14px;
      line-height: 20px;
      @apply(--montserrat-semibold);
    }

    .error {
      text-align: center;
      width: 80%;
      max-width: 500px;
      box-sizing: border-box;
      padding: 8px;
    }


    </style>


    <div class="total vertic centercenter">
      <paper-input class="centertxt" id="pas1" label="password" type="password" value="{{password}}" autofocus></paper-input>
      <template is="dom-if" if="{{double}}">
      <paper-input class="centertxt" id="pas2" label="password" type="password" value="{{passwordrepeat}}"></paper-input>
      </template>
      <div class="whitespace"></div>
      <div class="whitespace"></div>

      <template is="dom-if" if="{{wrongpass}}">
      <div class="error">
        <p class="red">You entered the wrong password</p>
      </div>
      </template>
      <template is="dom-if" if="{{notequal}}">
        <div class="error">
          <p class="red">The password was not repeated correctly.</p>
        </div>
      </template>
      <div class="flex"></div>
      <paper-icon-button icon="sc-icons:arrowright" class$="big {{btncolor2}} shadow {{btncolor}}" disabled="{{btnable}}" on-tap="setPass" noink>next</paper-icon-button>


      <!-- <ac-button class="loginbtn" icon="ac-arrowright" on-tap="setPass" bg="btncolor" txtcolor="yellow" disabled="{{btnable}}"></ac-button> -->
    </div>


</template>
  <!-- Creates the element's prototype and registers it -->
  <script>
    Polymer({
      is: 'ac-password',
      properties: {
        wrongpass: {
          type: Boolean,
          value: false
        },
        password: {
          type: String,
          notify: true,
          observer: '_passwordlength'

        },
        passwordrepeat: {
          type: String,
          observer: '_passwordrepeatlength'
        },
        sessionname: {
          type: String
        },
        btnable: {
          type: Boolean,
          value: true
        },

        double: {
          type: Boolean
        }
        // unlocked: {
        //   type: Boolean,
        //   notify: true
        // }
      },

      attached: function() {
        this.$.pas1.addEventListener('bind-value-changed', function(e) {
          this.notequal = false;
        }.bind(this));
        // this.$.pas2.addEventListener('bind-value-changed', function(e) {
        //   this.notequal = false;
        // }.bind(this));
              this.btncolor = "grey4";
              this.btncolor2 = "grey1back";

      },

      _sessionName: function(name){
        return 'ac-password-' + name;
      },

      setPass: function() {
        if (this.double){
          if (this.password !== this.passwordrepeat){
            this.notequal = true;
            return;
          }
        }
        if (this.password){
          if (this.sessionname){
            sessionStorage.setItem(this._sessionName(this.sessionname), this.password);
          }
          this.fire('password-received',{password:this.password});
        }
      },


      _passwordrepeatlength: function(){
        if (this.double){
          if (this.password && this.password.length > 8 && this.passwordrepeat.length > 8){ 
              this.btnable = false;
              this.btncolor = "blue";
              this.btncolor2 = "whiteback";

                } else {
            this.btnable = true;
              this.btncolor = "grey4";
              this.btncolor2 = "grey1back";

                }
              } else {
                if (this.password && this.password.length > 8){
                  this.btnable = false;
                  this.btncolor = "blue";
                  this.btncolor2 = "whiteback";
                      } else {
                  this.btnable = true;
                  this.btncolor = "grey4";
                  this.btncolor2 = "grey1back";
                      }
              }

      },

      _passwordlength: function(){
        if (!this.double) {
                if (this.password && this.password.length > 8){
                  this.btnable = false;
              this.btncolor = "blue";
              this.btncolor2 = "whiteback";

                      } else {
                  this.btnable = true;
              this.btncolor = "grey4";
              this.btncolor2 = "grey1back";

                      }
              }

      },


      ready: function() {
        if (this.double){
          return;
        }
        if (this.sessionname) {
          var _password = sessionStorage.getItem(this._sessionName(this.sessionname));
          if (_password) {
            this.fire('password-received', {
              password: _password
            });
          }
        }
      }
    });
  </script>
</dom-module>
